(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(7270)}])},7270:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return v}});var a=n(5893),o=n(9095),r=n(8134),s=n(9253),i=n(5769),l=n(9489),c=n(9e3),d=n(4913),p=n(7294),u=n(9477),x=n(7740),h=n(6949);let f=(0,h.sj)({intro:!0,color:"#ffffff",caseType:"transparent",customImage:null,customText:"",patches:[],leatherColors:["#1a1a1a","#8D6E63","#E64A19","#1976D2"],fabricColors:["#f5f5f5","#333333","#3F51B5","#009688"]});function m(e){let{scene:t}=e;return(0,a.jsx)("primitive",{object:t})}function g(e){let{originalScene:t,item:n,customTexture:o,scratchMap:s,leatherNormal:i}=e,l=(0,p.useMemo)(()=>t.clone(),[t]),[c,d]=(0,p.useState)(null),[x,h]=(0,p.useState)(null),f=(0,p.useRef)(null);(0,p.useEffect)(()=>{f.current=c},[c]),(0,p.useEffect)(()=>{if("transparent"!==n.name)return;let e=null,t=0;if(l.traverse(n=>{if(n.isMesh){let a=n.name.toLowerCase(),o=a.includes("screen")||a.includes("camera")||a.includes("lens")||a.includes("flash");if(!o){n.geometry.boundingBox||n.geometry.computeBoundingBox();let a=n.geometry.boundingBox,o=(a.max.x-a.min.x)*(a.max.y-a.min.y);o>t&&(t=o,e=n)}}}),d(e),e){let t=e.geometry.boundingBox,n=new u.Vector3;t.getCenter(n),h({position:[n.x,n.y,t.min.z+.01],rotation:[0,Math.PI,0],scale:[(t.max.x-t.min.x)*.9,(t.max.y-t.min.y)*.9,.2]})}},[l,n.name]);let m=(0,p.useMemo)(()=>"leather"===n.name?new u.MeshStandardMaterial({color:n.color,normalMap:i,normalScale:new u.Vector2(1.5,1.5),roughness:.5,metalness:0,envMapIntensity:1,side:u.FrontSide}):"transparent"===n.name||"clear"===n.name?new u.MeshPhysicalMaterial({color:16777215,transmission:1,opacity:1,transparent:!0,roughness:.15,roughnessMap:s,metalness:0,ior:1.5,thickness:0,clearcoat:1,clearcoatRoughness:.1,clearcoatRoughnessMap:s,envMapIntensity:1.5,side:u.FrontSide}):null,[n.name,n.color,s,i]);if((0,p.useEffect)(()=>{m&&l.traverse(e=>{if(e.isMesh){let t=e.name.toLowerCase(),n=t.includes("camera")||t.includes("lens")||t.includes("flash")||t.includes("port")||t.includes("button")||t.includes("key")||t.includes("mic")||t.includes("speaker")||t.includes("logo")||t.includes("apple"),a=t.includes("screen")||t.includes("display")||t.includes("front")||t.includes("black")||t.includes("bezel")||t.includes("wallpaper")||t.includes("touch")||t.includes("glass")&&!t.includes("back")&&!t.includes("rear");n||a?e.visible=!1:(e.visible=!0,e.material=m,e.castShadow=!0,e.receiveShadow=!0)}})},[l,m]),!m)return null;let g="leather"===n.name?[1.025,1.025,1.025]:[1.001,1.001,1.001];return(0,a.jsx)("group",{children:(0,a.jsx)("primitive",{object:l,scale:g,children:"transparent"===n.name&&o&&c&&x&&(0,a.jsx)(r._,{mesh:f,position:x.position,rotation:x.rotation,scale:x.scale,children:(0,a.jsx)("meshPhysicalMaterial",{map:o,transparent:!0,polygonOffset:!0,polygonOffsetFactor:-10,roughness:.4,clearcoat:.5,side:u.DoubleSide,depthTest:!0,depthWrite:!1})})})})}function y(e){let t=(0,x.R)(f),{scene:n}=(0,s.L)("/models/iphone.glb"),o=(0,p.useMemo)(()=>n.clone(),[n]),[r,l]=(0,i.m)(["/scratch.jpg","/leather_normal.png"]);(0,p.useEffect)(()=>{r&&(r.wrapS=r.wrapT=u.RepeatWrapping,r.repeat.set(3,3),r.anisotropy=16,r.colorSpace=u.NoColorSpace),l&&(l.wrapS=l.wrapT=u.RepeatWrapping,l.repeat.set(8,8),l.colorSpace=u.NoColorSpace,l.needsUpdate=!0)},[r,l]);let[c,d]=(0,p.useState)(null);return(0,p.useEffect)(()=>{if(t.customImage){let e=new u.TextureLoader;e.load(t.customImage,e=>{e.colorSpace=u.SRGBColorSpace,e.flipY=!1,e.anisotropy=16,d(e)})}else d(null)},[t.customImage]),(0,a.jsxs)("group",{children:[(0,a.jsx)(m,{scene:o}),(0,a.jsx)(g,{originalScene:n,item:e.item,customTexture:c,scratchMap:r,leatherNormal:l})]})}function b(){let e=(0,x.R)(f),t={name:e.caseType||"leather",color:e.color||"#e67e22"};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.qA,{preset:"studio"}),(0,a.jsx)("ambientLight",{intensity:.5}),(0,a.jsx)("directionalLight",{position:[5,5,5],intensity:1}),(0,a.jsx)(c.M,{children:(0,a.jsx)(y,{item:t})}),(0,a.jsx)(d.z,{makeDefault:!0,minPolarAngle:0,maxPolarAngle:Math.PI,minDistance:.15,maxDistance:.8,enablePan:!1})]})}var j=n(1526),w=n(3495);function S(){let e=(0,x.R)(f),[t,n]=(0,p.useState)(!1),o={type:"spring",duration:.8},r={initial:{y:100,opacity:0,transition:{...o,delay:.5}},animate:{y:0,opacity:1,transition:{...o,delay:0}},exit:{y:100,opacity:0,transition:{...o,delay:0}}},s=async()=>{n(!0);try{let e=document.querySelector("canvas"),t=e?e.toDataURL("image/png"):null,n={caseType:f.caseType,color:f.color,customText:f.customText,selectedFont:f.selectedFont,patches:f.patches,hasUserImage:!!f.customImage,screenshot:t},a=await fetch("/api/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),o=await a.json();o.success?alert("\uD83C\uDF89 ".concat(o.message,"\n订单号: ").concat(o.orderId)):alert("下单失败，请重试")}catch(e){console.error("下单出错:",e),alert("网络错误，无法连接到服务器")}finally{n(!1)}};return(0,a.jsxs)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:100},children:[(0,a.jsxs)("header",{style:{position:"absolute",top:40,left:40,zIndex:110},children:[(0,a.jsx)("h1",{style:{fontFamily:"'Inter', sans-serif",fontSize:"3em",fontWeight:900,letterSpacing:"-0.05em",color:"#333"},children:"MATSUSAKA"}),(0,a.jsx)("p",{style:{marginTop:5,fontSize:"1em",color:"#666",letterSpacing:"0.2em"},children:"BESPOKE STUDIO"})]}),(0,a.jsx)(j.M,{children:e.intro?(0,a.jsx)(w.E.section,{...r,style:{pointerEvents:"auto"},children:(0,a.jsxs)("div",{style:{position:"absolute",bottom:0,left:0,width:"100%",padding:"20px 40px 60px",background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",borderTopLeftRadius:"30px",borderTopRightRadius:"30px",boxShadow:"0 -10px 40px rgba(0,0,0,0.2)",display:"flex",flexDirection:"column",gap:"25px",zIndex:120},children:[(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",gap:"15px"},children:["transparent","leather","fabric"].map(t=>(0,a.jsxs)("button",{onClick:()=>{f.caseType=t,"leather"===t&&(f.color="#1a1a1a"),"transparent"===t&&(f.color="#ffffff"),"fabric"===t&&(f.color="#f5f5f5")},style:{padding:"10px 25px",borderRadius:"30px",border:"none",background:e.caseType===t?"#000":"#f0f0f0",color:e.caseType===t?"#fff":"#888",fontWeight:"bold",cursor:"pointer",fontSize:"1rem",boxShadow:e.caseType===t?"0 4px 10px rgba(0,0,0,0.3)":"none",transition:"all 0.2s"},children:["transparent"===t&&"\uD83D\uDD2E 晶莹透明","leather"===t&&"\uD83D\uDC5C 奢华真皮","fabric"===t&&"\uD83E\uDDF6 手工布艺"]},t))}),(0,a.jsx)("div",{style:{width:"100%",height:"1px",background:"#eee"}}),(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:20},children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"20px",flex:1,flexWrap:"wrap"},children:["transparent"===e.caseType&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("label",{style:{cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",background:"#000",color:"#fff",padding:"10px 20px",borderRadius:"20px",fontWeight:"bold"},children:["\uD83D\uDCF7 上传照片",(0,a.jsx)("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:e=>{let t=e.target.files[0];t&&(f.customImage=URL.createObjectURL(t))}})]}),(0,a.jsx)("input",{type:"text",placeholder:"输入你的名字...",value:e.customText,onChange:e=>f.customText=e.target.value,style:{padding:"10px 15px",borderRadius:"15px",border:"2px solid #eee",outline:"none",width:"200px",fontSize:"1rem"}})]}),"leather"===e.caseType&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{display:"flex",gap:"15px"},children:e.leatherColors.map(t=>(0,a.jsx)("div",{onClick:()=>f.color=t,style:{width:40,height:40,borderRadius:"50%",background:t,border:e.color===t?"3px solid #000":"2px solid #eee",cursor:"pointer",transform:e.color===t?"scale(1.1)":"scale(1)"}},t))}),(0,a.jsx)("input",{type:"text",placeholder:"VIP",maxLength:5,value:e.customText,onChange:e=>f.customText=e.target.value.toUpperCase(),style:{padding:"10px 15px",borderRadius:"15px",border:"2px solid #eee",width:"100px",textAlign:"center",fontWeight:"bold"}})]}),"fabric"===e.caseType&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[["\uD83E\uDDF8","\uD83C\uDF38","⭐","\uD83C\uDF80","\uD83E\uDDF5"].map(e=>(0,a.jsx)("button",{onClick:()=>f.patches.push({id:Math.random(),content:e,x:(Math.random()-.5)*.5,y:(Math.random()-.5)*1,rotation:(Math.random()-.5)*Math.PI/2}),style:{fontSize:"1.8em",background:"white",border:"1px solid #eee",borderRadius:"10px",width:50,height:50,cursor:"pointer",boxShadow:"0 2px 5px rgba(0,0,0,0.05)"},children:e},e)),(0,a.jsx)("button",{onClick:()=>f.patches=[],style:{fontSize:"0.9em",color:"#888",border:"1px solid #ddd",borderRadius:"10px",background:"white",padding:"0 15px",height:50,cursor:"pointer"},children:"清除"})]}),(0,a.jsx)("div",{style:{width:"1px",height:"40px",background:"#ddd",margin:"0 10px"}}),(0,a.jsx)("div",{style:{display:"flex",gap:"10px"},children:e.fabricColors.map(t=>(0,a.jsx)("div",{onClick:()=>f.color=t,style:{width:35,height:35,borderRadius:"50%",background:t,border:e.color===t?"2px solid #333":"1px solid #ddd",cursor:"pointer"}},t))})]})]}),(0,a.jsx)("button",{onClick:s,disabled:t,style:{background:t?"#999":"#000",color:"#fff",padding:"15px 40px",borderRadius:"40px",border:"none",fontSize:"1.1rem",fontWeight:"bold",cursor:t?"not-allowed":"pointer",boxShadow:"0 10px 20px rgba(0,0,0,0.2)",minWidth:"180px",transition:"all 0.3s"},children:t?"提交中...":"完成设计 →"})]})]})},"main"):null})]})}function v(){return(0,a.jsxs)("div",{style:{width:"100vw",height:"100vh",background:"#e0e0e0"},children:[(0,a.jsx)(o.Xz,{shadows:!0,camera:{position:[0,0,-.25],fov:45},gl:{preserveDrawingBuffer:!0},children:(0,a.jsx)(b,{})}),(0,a.jsx)(S,{})]})}}},function(e){e.O(0,[774,737,902,888,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);